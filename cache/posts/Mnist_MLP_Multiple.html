<p>this is a work in progress</p>
<pre class="code python3"><a name="rest_code_373c1235284a407aa62d432350462215-1"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<a name="rest_code_373c1235284a407aa62d432350462215-2"></a><span class="kn">import</span> <span class="nn">argparse</span>
<a name="rest_code_373c1235284a407aa62d432350462215-3"></a><span class="kn">import</span> <span class="nn">torch</span>
<a name="rest_code_373c1235284a407aa62d432350462215-4"></a><span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<a name="rest_code_373c1235284a407aa62d432350462215-5"></a><span class="kn">import</span> <span class="nn">torch.nn.functional</span> <span class="k">as</span> <span class="nn">F</span>
<a name="rest_code_373c1235284a407aa62d432350462215-6"></a><span class="kn">import</span> <span class="nn">torch.optim</span> <span class="k">as</span> <span class="nn">optim</span>
<a name="rest_code_373c1235284a407aa62d432350462215-7"></a><span class="kn">from</span> <span class="nn">torchvision</span> <span class="k">import</span> <span class="n">datasets</span><span class="p">,</span> <span class="n">transforms</span>
<a name="rest_code_373c1235284a407aa62d432350462215-8"></a><span class="kn">from</span> <span class="nn">torch.autograd</span> <span class="k">import</span> <span class="n">Variable</span>
</pre><pre class="code python3"><a name="rest_code_47c3a8e26c9a4f2284f5520a1385fac2-1"></a><span class="k">class</span> <span class="nc">Args</span><span class="p">:</span>
<a name="rest_code_47c3a8e26c9a4f2284f5520a1385fac2-2"></a>    <span class="k">pass</span>
<a name="rest_code_47c3a8e26c9a4f2284f5520a1385fac2-3"></a>
<a name="rest_code_47c3a8e26c9a4f2284f5520a1385fac2-4"></a><span class="n">args</span> <span class="o">=</span> <span class="n">Args</span><span class="p">()</span>
<a name="rest_code_47c3a8e26c9a4f2284f5520a1385fac2-5"></a><span class="n">args</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">12</span>
<a name="rest_code_47c3a8e26c9a4f2284f5520a1385fac2-6"></a><span class="n">args</span><span class="o">.</span><span class="n">cuda</span> <span class="o">=</span> <span class="kc">True</span>
<a name="rest_code_47c3a8e26c9a4f2284f5520a1385fac2-7"></a><span class="n">args</span><span class="o">.</span><span class="n">lr</span> <span class="o">=</span> <span class="mf">0.001</span>
<a name="rest_code_47c3a8e26c9a4f2284f5520a1385fac2-8"></a><span class="n">args</span><span class="o">.</span><span class="n">momentum</span> <span class="o">=</span> <span class="mf">0.01</span>
<a name="rest_code_47c3a8e26c9a4f2284f5520a1385fac2-9"></a><span class="n">args</span><span class="o">.</span><span class="n">epochs</span> <span class="o">=</span> <span class="mi">10</span>
<a name="rest_code_47c3a8e26c9a4f2284f5520a1385fac2-10"></a><span class="n">args</span><span class="o">.</span><span class="n">log_interval</span> <span class="o">=</span> <span class="mi">10</span>
</pre><pre class="code python3"><a name="rest_code_ff7a30184c5b43ecbd0c8c239fdc4533-1"></a><span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;num_workers&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;pin_memory&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span> <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">cuda</span> <span class="k">else</span> <span class="p">{}</span>
<a name="rest_code_ff7a30184c5b43ecbd0c8c239fdc4533-2"></a><span class="n">train_loader</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span>
<a name="rest_code_ff7a30184c5b43ecbd0c8c239fdc4533-3"></a>    <span class="n">datasets</span><span class="o">.</span><span class="n">MNIST</span><span class="p">(</span><span class="s1">&#39;../data&#39;</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a name="rest_code_ff7a30184c5b43ecbd0c8c239fdc4533-4"></a>                   <span class="n">transform</span><span class="o">=</span><span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">([</span>
<a name="rest_code_ff7a30184c5b43ecbd0c8c239fdc4533-5"></a>                       <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">(),</span>
<a name="rest_code_ff7a30184c5b43ecbd0c8c239fdc4533-6"></a>                       <span class="n">transforms</span><span class="o">.</span><span class="n">Normalize</span><span class="p">((</span><span class="mf">0.1307</span><span class="p">,),</span> <span class="p">(</span><span class="mf">0.3081</span><span class="p">,))</span>
<a name="rest_code_ff7a30184c5b43ecbd0c8c239fdc4533-7"></a>                   <span class="p">])),</span>
<a name="rest_code_ff7a30184c5b43ecbd0c8c239fdc4533-8"></a>    <span class="n">batch_size</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a name="rest_code_ff7a30184c5b43ecbd0c8c239fdc4533-9"></a>
<a name="rest_code_ff7a30184c5b43ecbd0c8c239fdc4533-10"></a><span class="n">test_loader</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span>
<a name="rest_code_ff7a30184c5b43ecbd0c8c239fdc4533-11"></a>    <span class="n">datasets</span><span class="o">.</span><span class="n">MNIST</span><span class="p">(</span><span class="s1">&#39;../data&#39;</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a name="rest_code_ff7a30184c5b43ecbd0c8c239fdc4533-12"></a>                    <span class="n">transform</span><span class="o">=</span><span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">([</span>
<a name="rest_code_ff7a30184c5b43ecbd0c8c239fdc4533-13"></a>                        <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">(),</span>
<a name="rest_code_ff7a30184c5b43ecbd0c8c239fdc4533-14"></a>                        <span class="n">transforms</span><span class="o">.</span><span class="n">Normalize</span><span class="p">((</span><span class="mf">0.1307</span><span class="p">,),</span> <span class="p">(</span><span class="mf">0.3081</span><span class="p">,))</span>
<a name="rest_code_ff7a30184c5b43ecbd0c8c239fdc4533-15"></a>                    <span class="p">])),</span>
<a name="rest_code_ff7a30184c5b43ecbd0c8c239fdc4533-16"></a>    <span class="n">batch_size</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre><p>Lets take a look into how the dataset looks like</p>
<pre class="code python3"><a name="rest_code_a7fb5a2d3823414f829da23153407c48-1"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a name="rest_code_a7fb5a2d3823414f829da23153407c48-2"></a><span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="k">import</span> <span class="n">ImageGrid</span>
<a name="rest_code_a7fb5a2d3823414f829da23153407c48-3"></a><span class="kn">from</span> <span class="nn">PIL</span> <span class="k">import</span> <span class="n">Image</span>
<a name="rest_code_a7fb5a2d3823414f829da23153407c48-4"></a><span class="kn">import</span> <span class="nn">pprint</span>
<a name="rest_code_a7fb5a2d3823414f829da23153407c48-5"></a><span class="kn">import</span> <span class="nn">numpy</span>
<a name="rest_code_a7fb5a2d3823414f829da23153407c48-6"></a>
<a name="rest_code_a7fb5a2d3823414f829da23153407c48-7"></a><span class="n">num_of_samples</span> <span class="o">=</span> <span class="mi">5</span>
<a name="rest_code_a7fb5a2d3823414f829da23153407c48-8"></a>
<a name="rest_code_a7fb5a2d3823414f829da23153407c48-9"></a><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,(</span><span class="mf">8.</span><span class="p">,</span> <span class="mf">8.</span><span class="p">))</span>
<a name="rest_code_a7fb5a2d3823414f829da23153407c48-10"></a><span class="n">grid</span> <span class="o">=</span> <span class="n">ImageGrid</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span>
<a name="rest_code_a7fb5a2d3823414f829da23153407c48-11"></a>                 <span class="n">nrows_ncols</span><span class="o">=</span><span class="p">(</span><span class="n">num_of_samples</span><span class="p">,</span> <span class="n">num_of_samples</span><span class="p">),</span>
<a name="rest_code_a7fb5a2d3823414f829da23153407c48-12"></a>                 <span class="n">axes_pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<a name="rest_code_a7fb5a2d3823414f829da23153407c48-13"></a>
<a name="rest_code_a7fb5a2d3823414f829da23153407c48-14"></a><span class="n">output</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_of_samples</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<a name="rest_code_a7fb5a2d3823414f829da23153407c48-15"></a><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">test_loader</span><span class="p">):</span>
<a name="rest_code_a7fb5a2d3823414f829da23153407c48-16"></a>    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span> <span class="c1">#dirty trick to take just one sample</span>
<a name="rest_code_a7fb5a2d3823414f829da23153407c48-17"></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_of_samples</span> <span class="o">**</span> <span class="mi">2</span><span class="p">):</span>
<a name="rest_code_a7fb5a2d3823414f829da23153407c48-18"></a>            <span class="n">grid</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()))</span>
<a name="rest_code_a7fb5a2d3823414f829da23153407c48-19"></a>            <span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
<a name="rest_code_a7fb5a2d3823414f829da23153407c48-20"></a>    <span class="k">else</span><span class="p">:</span>
<a name="rest_code_a7fb5a2d3823414f829da23153407c48-21"></a>        <span class="k">break</span>
<a name="rest_code_a7fb5a2d3823414f829da23153407c48-22"></a>
<a name="rest_code_a7fb5a2d3823414f829da23153407c48-23"></a>
<a name="rest_code_a7fb5a2d3823414f829da23153407c48-24"></a><span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">num_of_samples</span><span class="p">,</span> <span class="n">num_of_sample</span><span class="p">)</span>
<a name="rest_code_a7fb5a2d3823414f829da23153407c48-25"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre><pre class="literal-block">
[[ 6.  9.  9.  5.  4.]
 [ 3.  6.  5.  0.  1.]
 [ 8.  1.  3.  6.  2.]
 [ 9.  4.  8.  8.  6.]
 [ 0.  6.  4.  2.  3.]]
</pre>
<img alt="/images/mnist_study_in_pytorch/output_12_0.png" src="/images/mnist_study_in_pytorch/output_12_0.png" />
<p>You can see that the image of number &lt;&gt; is associated with number &lt;&gt;. It is a list of (image of number, number). As usual we are gonna feed the neural network with image from the left and its label from the right. We will train a set of feedforward networks in increasing order of complexity. What I mean by complexity is the number of neurons and number of layers.</p>
<pre class="code python3"><a name="rest_code_e40329ffb45a47e1b5006133970bb714-1"></a><span class="k">class</span> <span class="nc">Model0</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-2"></a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-3"></a>        <span class="nb">super</span><span class="p">(</span><span class="n">Model0</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">28</span><span class="o">*</span><span class="mi">28</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-5"></a>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-6"></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-7"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-8"></a>        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">log_softmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-9"></a>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-10"></a><span class="k">class</span> <span class="nc">Model1</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-11"></a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-12"></a>        <span class="nb">super</span><span class="p">(</span><span class="n">Model1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">28</span><span class="o">*</span><span class="mi">28</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-14"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-15"></a>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-16"></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-17"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-18"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-19"></a>        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">log_softmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-20"></a>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-21"></a><span class="k">class</span> <span class="nc">Model2</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-22"></a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-23"></a>        <span class="nb">super</span><span class="p">(</span><span class="n">Model2</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-24"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">28</span><span class="o">*</span><span class="mi">28</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-25"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-26"></a>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-27"></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-28"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-29"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-30"></a>        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">log_softmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-31"></a>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-32"></a><span class="k">class</span> <span class="nc">Model3</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-33"></a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-34"></a>        <span class="nb">super</span><span class="p">(</span><span class="n">Model3</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-35"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">28</span><span class="o">*</span><span class="mi">28</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-36"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-37"></a>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-38"></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-39"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-40"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-41"></a>        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">log_softmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-42"></a>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-43"></a><span class="k">class</span> <span class="nc">Model4</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-44"></a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-45"></a>        <span class="nb">super</span><span class="p">(</span><span class="n">Model4</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-46"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">28</span><span class="o">*</span><span class="mi">28</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-47"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-48"></a>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-49"></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-50"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-51"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-52"></a>        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">log_softmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-53"></a>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-54"></a><span class="k">class</span> <span class="nc">Model5</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-55"></a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-56"></a>        <span class="nb">super</span><span class="p">(</span><span class="n">Model5</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-57"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">28</span><span class="o">*</span><span class="mi">28</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-58"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-59"></a>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-60"></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-61"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-62"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-63"></a>        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">log_softmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-64"></a>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-65"></a><span class="k">class</span> <span class="nc">Model6</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-66"></a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-67"></a>        <span class="nb">super</span><span class="p">(</span><span class="n">Model6</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-68"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">28</span><span class="o">*</span><span class="mi">28</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-69"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-70"></a>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-71"></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-72"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-73"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-74"></a>        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">log_softmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-75"></a>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-76"></a><span class="k">class</span> <span class="nc">Model7</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-77"></a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-78"></a>        <span class="nb">super</span><span class="p">(</span><span class="n">Model7</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-79"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">28</span><span class="o">*</span><span class="mi">28</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-80"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-81"></a>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-82"></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-83"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-84"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-85"></a>        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">log_softmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-86"></a>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-87"></a><span class="k">class</span> <span class="nc">Model8</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-88"></a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-89"></a>        <span class="nb">super</span><span class="p">(</span><span class="n">Model8</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-90"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">28</span><span class="o">*</span><span class="mi">28</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-91"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hidden_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-92"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-93"></a>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-94"></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-95"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-96"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-97"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-98"></a>        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">log_softmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-99"></a>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-100"></a><span class="k">class</span> <span class="nc">Model9</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-101"></a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-102"></a>        <span class="nb">super</span><span class="p">(</span><span class="n">Model9</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-103"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">28</span><span class="o">*</span><span class="mi">28</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-104"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hidden_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-105"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hidden_layer1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-106"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-107"></a>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-108"></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-109"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-110"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-111"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_layer1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-112"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-113"></a>        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">log_softmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-114"></a>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-115"></a><span class="k">class</span> <span class="nc">Model10</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-116"></a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-117"></a>        <span class="nb">super</span><span class="p">(</span><span class="n">Model10</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-118"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">28</span><span class="o">*</span><span class="mi">28</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-119"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hidden_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-120"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hidden_layer1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-121"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hidden_layer2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-122"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-123"></a>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-124"></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-125"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-126"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-127"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_layer1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-128"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_layer2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-129"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a name="rest_code_e40329ffb45a47e1b5006133970bb714-130"></a>        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">log_softmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre><p>Lets create the model instances. If you have GPU this is how you can make use of it, by calling .cuda() on models and tensors</p>
<pre class="code python3"><a name="rest_code_a501664b32d34508b5f79c410be65d6c-1"></a><span class="n">models</span> <span class="o">=</span> <span class="n">Model0</span><span class="p">(),</span> <span class="n">Model1</span><span class="p">(),</span> <span class="n">Model2</span><span class="p">(),</span> <span class="n">Model3</span><span class="p">(),</span> <span class="n">Model4</span><span class="p">(),</span> <span class="n">Model5</span><span class="p">(),</span> <span class="n">Model6</span><span class="p">(),</span> <span class="n">Model7</span><span class="p">(),</span> <span class="n">Model8</span><span class="p">(),</span> <span class="n">Model9</span><span class="p">(),</span> <span class="n">Model10</span><span class="p">()</span>
<a name="rest_code_a501664b32d34508b5f79c410be65d6c-2"></a><span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">cuda</span><span class="p">:</span>
<a name="rest_code_a501664b32d34508b5f79c410be65d6c-3"></a>    <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
<a name="rest_code_a501664b32d34508b5f79c410be65d6c-4"></a>        <span class="n">model</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
</pre><pre class="code python3"><a name="rest_code_87f4ed8855f247c2aad17677b378c33a-1"></a><span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">print_every</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
<a name="rest_code_87f4ed8855f247c2aad17677b378c33a-2"></a>    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">lr</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">momentum</span><span class="p">)</span>
<a name="rest_code_87f4ed8855f247c2aad17677b378c33a-3"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epoch</span><span class="p">):</span>
<a name="rest_code_87f4ed8855f247c2aad17677b378c33a-4"></a>        <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
<a name="rest_code_87f4ed8855f247c2aad17677b378c33a-5"></a>        <span class="k">for</span> <span class="n">batch_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">train_loader</span><span class="p">):</span>
<a name="rest_code_87f4ed8855f247c2aad17677b378c33a-6"></a>            <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">cuda</span><span class="p">:</span>
<a name="rest_code_87f4ed8855f247c2aad17677b378c33a-7"></a>                <span class="n">data</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">cuda</span><span class="p">(),</span> <span class="n">target</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
<a name="rest_code_87f4ed8855f247c2aad17677b378c33a-8"></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">batch_size</span> <span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="rest_code_87f4ed8855f247c2aad17677b378c33a-9"></a>            <span class="n">data</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">Variable</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
<a name="rest_code_87f4ed8855f247c2aad17677b378c33a-10"></a>            <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
<a name="rest_code_87f4ed8855f247c2aad17677b378c33a-11"></a>            <span class="n">output</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a name="rest_code_87f4ed8855f247c2aad17677b378c33a-12"></a>
<a name="rest_code_87f4ed8855f247c2aad17677b378c33a-13"></a>            <span class="n">loss</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">nll_loss</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
<a name="rest_code_87f4ed8855f247c2aad17677b378c33a-14"></a>            <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
<a name="rest_code_87f4ed8855f247c2aad17677b378c33a-15"></a>            <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
<a name="rest_code_87f4ed8855f247c2aad17677b378c33a-16"></a>
<a name="rest_code_87f4ed8855f247c2aad17677b378c33a-17"></a>        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="n">print_every</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a name="rest_code_87f4ed8855f247c2aad17677b378c33a-18"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Train Epoch: </span><span class="si">{}</span><span class="s1"> [</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{:.0f}</span><span class="s1">%)]</span><span class="se">\t</span><span class="s1">Loss: </span><span class="si">{:.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a name="rest_code_87f4ed8855f247c2aad17677b378c33a-19"></a>                    <span class="n">i</span><span class="p">,</span> <span class="n">batch_idx</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_loader</span><span class="o">.</span><span class="n">dataset</span><span class="p">),</span>
<a name="rest_code_87f4ed8855f247c2aad17677b378c33a-20"></a>                    <span class="mf">100.</span> <span class="o">*</span> <span class="n">batch_idx</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_loader</span><span class="p">),</span> <span class="n">loss</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</pre><p>This is where the actual training starts. It will take a while, so I just trained them for 100 times on entire training dataset.</p>
<pre class="code python3"><a name="rest_code_1e617d5104bb4de2b47693a02bcb1a90-1"></a><span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
<a name="rest_code_1e617d5104bb4de2b47693a02bcb1a90-2"></a>    <span class="n">train</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
</pre><pre class="literal-block">
Train Epoch: 0 [59988/60000 (100%)]        Loss: 0.061506
.
.
.
.
Train Epoch: 98 [59988/60000 (100%)]       Loss: 0.018422
Train Epoch: 99 [59988/60000 (100%)]       Loss: 0.336890
</pre>
<p>Saving the model weights into a file, this should be in the above snippet or inside the training function for saving models every epoch.Lets just keep this simple</p>
<pre class="code python3"><a name="rest_code_ad8ccafff67849b488c6932049ca08ce-1"></a><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">models</span><span class="p">):</span>
<a name="rest_code_ad8ccafff67849b488c6932049ca08ce-2"></a>    <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span> <span class="s1">&#39;mnist_mlp_multiple_model</span><span class="si">{}</span><span class="s1">.pth&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
</pre><p>For the sake of completeness, this is how you load the saved models</p>
<pre class="code python3"><a name="rest_code_abcde41b13764b7db5d5ad63d0801e27-1"></a><span class="n">models</span> <span class="o">=</span> <span class="n">Model0</span><span class="p">(),</span> <span class="n">Model1</span><span class="p">(),</span> <span class="n">Model2</span><span class="p">(),</span> <span class="n">Model3</span><span class="p">(),</span> <span class="n">Model4</span><span class="p">(),</span> <span class="n">Model5</span><span class="p">(),</span> <span class="n">Model6</span><span class="p">(),</span> <span class="n">Model7</span><span class="p">(),</span> <span class="n">Model8</span><span class="p">(),</span> <span class="n">Model9</span><span class="p">(),</span> <span class="n">Model10</span><span class="p">()</span>
<a name="rest_code_abcde41b13764b7db5d5ad63d0801e27-2"></a><span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">cuda</span><span class="p">:</span>
<a name="rest_code_abcde41b13764b7db5d5ad63d0801e27-3"></a>    <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
<a name="rest_code_abcde41b13764b7db5d5ad63d0801e27-4"></a>        <span class="n">model</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
<a name="rest_code_abcde41b13764b7db5d5ad63d0801e27-5"></a>
<a name="rest_code_abcde41b13764b7db5d5ad63d0801e27-6"></a><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">models</span><span class="p">):</span>
<a name="rest_code_abcde41b13764b7db5d5ad63d0801e27-7"></a>    <span class="n">model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;mnist_mlp_multiple_model</span><span class="si">{}</span><span class="s1">.pth&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
</pre><p>Before we run the model over the test dataset, let take a peek into how one of the model performs</p>
<pre class="code python3"><a name="rest_code_966839424ebf4b5689344bac07c3b7af-1"></a><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<a name="rest_code_966839424ebf4b5689344bac07c3b7af-2"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a name="rest_code_966839424ebf4b5689344bac07c3b7af-3"></a><span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="k">import</span> <span class="n">ImageGrid</span>
<a name="rest_code_966839424ebf4b5689344bac07c3b7af-4"></a><span class="kn">from</span> <span class="nn">PIL</span> <span class="k">import</span> <span class="n">Image</span>
<a name="rest_code_966839424ebf4b5689344bac07c3b7af-5"></a><span class="kn">import</span> <span class="nn">pprint</span>
<a name="rest_code_966839424ebf4b5689344bac07c3b7af-6"></a><span class="kn">import</span> <span class="nn">numpy</span>
<a name="rest_code_966839424ebf4b5689344bac07c3b7af-7"></a>
<a name="rest_code_966839424ebf4b5689344bac07c3b7af-8"></a><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,(</span><span class="mf">8.</span><span class="p">,</span> <span class="mf">8.</span><span class="p">))</span>
<a name="rest_code_966839424ebf4b5689344bac07c3b7af-9"></a><span class="n">grid</span> <span class="o">=</span> <span class="n">ImageGrid</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span>  <span class="c1"># similar to subplot(111)</span>
<a name="rest_code_966839424ebf4b5689344bac07c3b7af-10"></a>                 <span class="n">nrows_ncols</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>  <span class="c1"># creates 2x2 grid of axes</span>
<a name="rest_code_966839424ebf4b5689344bac07c3b7af-11"></a>                 <span class="n">axes_pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>  <span class="c1"># pad between axes in inch.</span>
<a name="rest_code_966839424ebf4b5689344bac07c3b7af-12"></a>                 <span class="p">)</span>
<a name="rest_code_966839424ebf4b5689344bac07c3b7af-13"></a>
<a name="rest_code_966839424ebf4b5689344bac07c3b7af-14"></a><span class="n">output</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
<a name="rest_code_966839424ebf4b5689344bac07c3b7af-15"></a><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">test_loader</span><span class="p">):</span>
<a name="rest_code_966839424ebf4b5689344bac07c3b7af-16"></a>    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span> <span class="c1">#dirty trick</span>
<a name="rest_code_966839424ebf4b5689344bac07c3b7af-17"></a>
<a name="rest_code_966839424ebf4b5689344bac07c3b7af-18"></a>        <span class="n">data1</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
<a name="rest_code_966839424ebf4b5689344bac07c3b7af-19"></a>        <span class="n">data1</span> <span class="o">=</span> <span class="n">data1</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="rest_code_966839424ebf4b5689344bac07c3b7af-20"></a>        <span class="n">out</span> <span class="o">=</span> <span class="n">models</span><span class="p">[</span><span class="mi">9</span><span class="p">](</span><span class="n">Variable</span><span class="p">(</span><span class="n">data1</span><span class="p">))</span>
<a name="rest_code_966839424ebf4b5689344bac07c3b7af-21"></a>
<a name="rest_code_966839424ebf4b5689344bac07c3b7af-22"></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
<a name="rest_code_966839424ebf4b5689344bac07c3b7af-23"></a>            <span class="n">grid</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()))</span>
<a name="rest_code_966839424ebf4b5689344bac07c3b7af-24"></a>            <span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a name="rest_code_966839424ebf4b5689344bac07c3b7af-25"></a>
<a name="rest_code_966839424ebf4b5689344bac07c3b7af-26"></a>    <span class="k">else</span><span class="p">:</span>
<a name="rest_code_966839424ebf4b5689344bac07c3b7af-27"></a>        <span class="k">break</span>
<a name="rest_code_966839424ebf4b5689344bac07c3b7af-28"></a>
<a name="rest_code_966839424ebf4b5689344bac07c3b7af-29"></a><span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<a name="rest_code_966839424ebf4b5689344bac07c3b7af-30"></a><span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
<a name="rest_code_966839424ebf4b5689344bac07c3b7af-31"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre><pre class="literal-block">
[[ 6.  2.  9.  1.  8.]
 [ 5.  6.  5.  7.  5.]
 [ 4.  8.  6.  3.  0.]
 [ 6.  1.  0.  9.  3.]
 [ 7.  2.  8.  4.  4.]]
</pre>
<img alt="/images/mnist_study_in_pytorch/output_12_0.png" src="/images/mnist_study_in_pytorch/output_12_0.png" />
<p>As you can see, the results are not so bad.Lets test all our models.</p>
<pre class="code python3"><a name="rest_code_9dcb55ba313b4386924b7c9611b5c4dc-1"></a><span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
<a name="rest_code_9dcb55ba313b4386924b7c9611b5c4dc-2"></a>    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
<a name="rest_code_9dcb55ba313b4386924b7c9611b5c4dc-3"></a>    <span class="n">test_loss</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_9dcb55ba313b4386924b7c9611b5c4dc-4"></a>    <span class="n">correct</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_9dcb55ba313b4386924b7c9611b5c4dc-5"></a>    <span class="k">for</span> <span class="n">data</span><span class="p">,</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">test_loader</span><span class="p">:</span>
<a name="rest_code_9dcb55ba313b4386924b7c9611b5c4dc-6"></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">cuda</span><span class="p">:</span>
<a name="rest_code_9dcb55ba313b4386924b7c9611b5c4dc-7"></a>            <span class="n">data</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">cuda</span><span class="p">(),</span> <span class="n">target</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
<a name="rest_code_9dcb55ba313b4386924b7c9611b5c4dc-8"></a>
<a name="rest_code_9dcb55ba313b4386924b7c9611b5c4dc-9"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="rest_code_9dcb55ba313b4386924b7c9611b5c4dc-10"></a>        <span class="n">data</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">volatile</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">Variable</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
<a name="rest_code_9dcb55ba313b4386924b7c9611b5c4dc-11"></a>        <span class="n">output</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a name="rest_code_9dcb55ba313b4386924b7c9611b5c4dc-12"></a>        <span class="n">test_loss</span> <span class="o">+=</span> <span class="n">F</span><span class="o">.</span><span class="n">nll_loss</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a name="rest_code_9dcb55ba313b4386924b7c9611b5c4dc-13"></a>        <span class="n">pred</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># get the index of the max log-probability</span>
<a name="rest_code_9dcb55ba313b4386924b7c9611b5c4dc-14"></a>        <span class="n">correct</span> <span class="o">+=</span> <span class="n">pred</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a name="rest_code_9dcb55ba313b4386924b7c9611b5c4dc-15"></a>
<a name="rest_code_9dcb55ba313b4386924b7c9611b5c4dc-16"></a>    <span class="n">test_loss</span> <span class="o">=</span> <span class="n">test_loss</span>
<a name="rest_code_9dcb55ba313b4386924b7c9611b5c4dc-17"></a>    <span class="n">test_loss</span> <span class="o">/=</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_loader</span><span class="p">)</span> <span class="c1"># loss function already averages over batch size</span>
<a name="rest_code_9dcb55ba313b4386924b7c9611b5c4dc-18"></a>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Test set: Average loss: </span><span class="si">{:.4f}</span><span class="s1">, Accuracy: </span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{:.0f}</span><span class="s1">%)</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a name="rest_code_9dcb55ba313b4386924b7c9611b5c4dc-19"></a>        <span class="n">test_loss</span><span class="p">,</span> <span class="n">correct</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_loader</span><span class="o">.</span><span class="n">dataset</span><span class="p">),</span>
<a name="rest_code_9dcb55ba313b4386924b7c9611b5c4dc-20"></a>        <span class="mf">100.</span> <span class="o">*</span> <span class="n">correct</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_loader</span><span class="o">.</span><span class="n">dataset</span><span class="p">)))</span>
<a name="rest_code_9dcb55ba313b4386924b7c9611b5c4dc-21"></a>
<a name="rest_code_9dcb55ba313b4386924b7c9611b5c4dc-22"></a>    <span class="k">return</span> <span class="mf">100.</span> <span class="o">*</span> <span class="n">correct</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_loader</span><span class="o">.</span><span class="n">dataset</span><span class="p">)</span>
</pre><pre class="code python3"><a name="rest_code_80fd7fde638e46819400a316aee7de40-1"></a><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<a name="rest_code_80fd7fde638e46819400a316aee7de40-2"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a name="rest_code_80fd7fde638e46819400a316aee7de40-3"></a><span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="k">import</span> <span class="n">ImageGrid</span>
<a name="rest_code_80fd7fde638e46819400a316aee7de40-4"></a><span class="kn">from</span> <span class="nn">PIL</span> <span class="k">import</span> <span class="n">Image</span>
<a name="rest_code_80fd7fde638e46819400a316aee7de40-5"></a><span class="kn">import</span> <span class="nn">pprint</span>
<a name="rest_code_80fd7fde638e46819400a316aee7de40-6"></a><span class="kn">import</span> <span class="nn">numpy</span>
<a name="rest_code_80fd7fde638e46819400a316aee7de40-7"></a>
<a name="rest_code_80fd7fde638e46819400a316aee7de40-8"></a>
<a name="rest_code_80fd7fde638e46819400a316aee7de40-9"></a><span class="n">accuracy</span> <span class="o">=</span> <span class="p">[]</span>
<a name="rest_code_80fd7fde638e46819400a316aee7de40-10"></a><span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
<a name="rest_code_80fd7fde638e46819400a316aee7de40-11"></a>    <span class="n">accuracy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_tuts</span><span class="p">(</span><span class="n">model</span><span class="p">))</span>
<a name="rest_code_80fd7fde638e46819400a316aee7de40-12"></a>
<a name="rest_code_80fd7fde638e46819400a316aee7de40-13"></a><span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">accuracy</span><span class="p">)</span>
</pre><pre class="literal-block">
Test set: Average loss: 0.2764, Accuracy: 9250/10000 (92%)
Test set: Average loss: 0.3591, Accuracy: 9010/10000 (90%)
Test set: Average loss: 0.3204, Accuracy: 9121/10000 (91%)
Test set: Average loss: 0.2954, Accuracy: 9189/10000 (92%)
Test set: Average loss: 0.2767, Accuracy: 9237/10000 (92%)
Test set: Average loss: 0.2699, Accuracy: 9267/10000 (93%)
Test set: Average loss: 0.2700, Accuracy: 9251/10000 (93%)
Test set: Average loss: 0.2690, Accuracy: 9244/10000 (92%)
Test set: Average loss: 0.2755, Accuracy: 9240/10000 (92%)
Test set: Average loss: 0.2745, Accuracy: 9253/10000 (93%)
Test set: Average loss: 0.2789, Accuracy: 9232/10000 (92%)

[92.5, 90.1, 91.21, 91.89, 92.37, 92.67, 92.51, 92.44, 92.4, 92.53, 92.32]
</pre>
<pre class="code python3"><a name="rest_code_9bae9163f92744f99ad9c329ca738f9e-1"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">accuracy</span><span class="p">)),</span> <span class="n">accuracy</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<a name="rest_code_9bae9163f92744f99ad9c329ca738f9e-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>
<a name="rest_code_9bae9163f92744f99ad9c329ca738f9e-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a name="rest_code_9bae9163f92744f99ad9c329ca738f9e-4"></a>
<a name="rest_code_9bae9163f92744f99ad9c329ca738f9e-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">accuracy</span><span class="p">)),</span> <span class="n">accuracy</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<a name="rest_code_9bae9163f92744f99ad9c329ca738f9e-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">93</span><span class="p">])</span>
<a name="rest_code_9bae9163f92744f99ad9c329ca738f9e-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre><img alt="/images/mnist_study_in_pytorch/output_11_0.png" src="/images/mnist_study_in_pytorch/output_11_0.png" />
<img alt="/images/mnist_study_in_pytorch/output_11_1.png" src="/images/mnist_study_in_pytorch/output_11_1.png" />
<p>The right image is a little zoomed in version of the left one. Little dissappointing, isn't it? The more complex models doesn't seem to perform as we would expect. So we can understand that the performance is not proportional to number of layers in neural network. It is in how they interact with each other.</p>
